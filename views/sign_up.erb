<div class = "container mt-3">
    <form class = "col-md-5 col-md-offset-1" action = "/signup" method = "POST" name = "signup">
        <div class = "controls">
            <div class = "form-group">
                <label for="formGroupExampleInput">ユーザー名</label>
                <input class = "form-control input-lg alpha" type = "text" name = "name" placeholder = "半角英数字と_のみ 16文字以下"><br>
                
                <label for="formGroupExampleInput">パスワード</label>
                <input class = "form-control input-lg" type = "password" name = "password" placeholder = "6~10文字"><br>
                
                <label for="formGroupExampleInput">パスワードの確認</label>
                <input class = "form-control input-lg" type = "password" name = "password_confirmation" placeholder = "パスワードをもう一度入力"><br>
            </div>
            <div class = "form-group col-lg-5">
                <button class = "form-group col-lg-4 btn btn-secondary" id = "register" type = "submit" onclick="return userCheck();">新規登録</button>
            </div>
            
            <%#<%= @users %>
        </div>
    </form>
</div>
<script>
function userCheck(){//ユーザー名入力チェック欄
    let userName = document.signup.name.value//検索語句を取得
    console.log(userName)
    
    for(let i=0 ; i<userName.length; i++){
        let code=userName.charCodeAt(i);
        
    }
    return false;
};

document.addEventListener('DOMContentLoaded', function() {
  // --------------------------------------------
  // ▼英字と特定の記号の入力チェック用スクリプト
  // --------------------------------------------
  let targets = document.getElementsByClassName('alpha')
  
  for (let i=0 ; i<targets.length ; i++) {
    // ▼文字が入力されたタイミングでチェックする：
    targets[i].oninput = function () {
      let alertelement = this.parentNode.getElementsByClassName('alertarea');
      if( ( this.value != '') && ( this.value.match( /[^a-zA-Z0-9_!#%&]/ )) ) {
        // ▼何か入力があって、指定以外の文字があれば
        if( alertelement[0] ) { alertelement[0].innerHTML = '入力には、英数字と記号「_!#$%&」だけが使えます。'; }
        
        //エラーで、エラーメッセージがなかったら
          if(!$(this).nextAll('div.alert-warning').length)
          {
            //メッセージを後ろに追加
            $(this).after(
              '<div class = "alert alert-warning" style = "font-size: 13px;">英数字とアンダーバー以外が含まれています</div>'
            );
            $('#register').prop('disabled',true);
          }
      }
      else if(( this.value != '') && ( <%= @users %>.includes(this.value) )){
          //エラーで、エラーメッセージがなかったら
          if(!$(this).nextAll('div.alert-warning').length)
          {
            //メッセージを後ろに追加
            $(this).after(
              '<div class = "alert alert-warning" style = "font-size: 13px;">このユーザー名は既に使われています</div>'
            );
            $('#register').prop('disabled',true);
          }
      }
      else {
        // ▼何も入力がないか、または指定文字しかないなら
        if( alertelement[0] ) { alertelement[0].innerHTML = ""; }
        // this.style.border = "1px solid black";
         //エラーじゃないのにメッセージがあったら
          if($(this).nextAll('div.alert-warning').length)
          {
            //消す
            $(this).nextAll('div.alert-warning').remove();
            $('#register').prop('disabled',false);
          }
          
      }
    }
  }
  // ----------
  // ▲ここまで
  // ----------

});
</script>




